## 文件 `lib/lib_err.h` 是 `filesystem` 项目中的一个头文件，主要用于定义错误处理相关的函数原型。这个文件通过宏定义 `#ifndef`, `#define`, `#endif` 来防止头文件被重复包含，这是一种常见的C语言编程实践。

文件中定义了四个函数原型，每个函数都接受一个 `const char *` 类型的参数，用于传递错误信息：

1. `void err_msg(const char *err);`
   - 这个函数用于打印错误信息到标准错误输出。

2. `void err_exit(const char *err);`
   - 这个函数在打印错误信息后调用 `exit()` 函数退出程序。

3. `void usage_err(const char *err);`
   - 这个函数用于打印使用错误信息，通常用于提示用户程序的正确使用方法，并在打印后退出程序。

4. `void fatal_err(const char *err);`
   - 这个函数用于处理致命错误，打印错误信息后可能会采取特定的处理措施，如记录日志或尝试恢复等，然后退出程序。

这些函数为项目提供了一套统一的错误处理机制，使得错误信息的输出和程序的退出行为可以被集中管理，提高了代码的可维护性和可读性。

## 文件 ` filesystem/lib/lib_sys.h` 是一个C语言头文件，主要用于包含和定义系统级操作所需的基本函数和宏。以下是对该文件内容的概述：

1. **包含的头文件**:
   - `stdio.h`: 提供标准输入输出函数。
   - `stdlib.h`: 提供标准库函数，如内存分配、转换函数等。
   - `string.h`: 提供字符串处理函数。
   - `unistd.h`: 提供Unix系统调用，如文件操作、进程控制等。
   - `errno.h`: 定义错误代码。
   - `fcntl.h`: 提供文件控制操作的宏。
   - `sys/types.h`: 定义系统数据类型。
   - `sys/stat.h`: 提供文件状态查询函数。
   - `lib_err.h`: 自定义的错误处理函数头文件。

2. **宏定义**:
   - `TRUE` 和 `FALSE`: 定义布尔值真和假。
   - `min(m, n)` 和 `max(m, n)`: 定义两个值中的最小值和最大值。

这个头文件的主要目的是为了提供一个统一的接口，用于处理系统级操作，如文件操作、错误处理等。通过包含这个头文件，其他模块可以方便地使用这些定义和函数，而不需要重复定义或包含多个头文件。这有助于提高代码的可维护性和可读性。

## 文件 `filesystem/prompt.h` 是一个C语言源代码文件，主要用于处理文件系统的交互式命令行界面（shell）。以下是对该文件内容的概述：

1. **包含文件**：
   - `#include "exec.h"`：包含了一个外部头文件，可能是用于执行命令的函数或定义。

2. **常量定义**：
   - `#define MAXLINE 1024`：定义了命令行输入的最大长度。
   - `#define MAXARGS 128`：定义了命令行参数的最大数量。

3. **全局变量**：
   - `char theme[] = "Here to control file system"`：定义了一个字符串变量，用于显示在命令行界面的提示信息。

4. **函数原型**：
   - `void eval(char *cmdline)`：评估用户输入的命令行。
   - `int parseline(const char *cmdline, char **argv)`：解析命令行，构建参数数组。

5. **函数实现**：
   - `void print_version()`：打印文件系统的版本信息。
   - `void print_usage()`：打印使用帮助信息。
   - `int Start_Shell(int argc, char **argv)`：启动shell，处理命令行参数，进行登录验证，加载超级块，并进入命令循环。
   - `void eval(char *cmdline)`：评估命令行，处理内置命令和外部命令。
   - `int parseline(const char *cmdline, char **argv)`：解析命令行，提取参数。

该文件的主要功能是提供一个交互式的命令行界面，允许用户输入命令来操作文件系统。它包括了命令解析、内置命令处理、外部命令执行等功能，并通过命令行参数支持不同的操作模式（如开发者模式）。

## 文件 `exec.h` 是 项目中的一个关键组件，位于 `filesystem` 目录下。该文件主要定义了文件系统的命令处理逻辑，包括内置命令和开发者命令的处理。以下是对该文件内容的概述：

1. **包含头文件**：
   - `#include "filesystem.h"`：引入了文件系统相关的头文件，这表明 `exec.h` 依赖于 `filesystem.h` 中定义的函数和数据结构。

2. **全局变量**：
   - `int developer = 1;`：定义了一个整型变量 `developer`，用于控制是否使用开发者API。如果 `developer` 为0，则不使用开发者API。

3. **函数定义**：
   - `void print_help(void)`：打印帮助信息，包括文件系统的支持命令列表。根据 `developer` 的值，还可能打印开发者操作的命令。
   - `int developer_cmd(int argc, char **argv)`：处理开发者命令。根据命令名调用相应的函数，并返回命令执行结果。
   - `int builtin_cmd(char **argv)`：处理内置命令，如 `fmt`、`passwd`、`exit` 和 `help`。根据命令名调用相应的函数，并返回命令执行结果。
   - `int py_execute(char *func, int argc, char **argv)`：主要的执行函数，根据传入的函数名和参数执行相应的文件系统操作，如 `mkdir`、`rmdir`、`cd`、`ls`、`touch` 等。每个操作都会检查参数的正确性，并执行相应的文件系统操作。

4. **命令处理逻辑**：
   - 文件中的函数通过比较命令名和参数来确定要执行的操作。每个命令处理函数都会检查参数的合法性，并执行相应的操作，如创建目录、删除文件、改变目录、显示文件列表等。
   - 对于需要特殊权限的操作（如格式化磁盘），会检查当前用户的权限，并在必要时提示权限不足。

5. **错误处理**：
   - 每个操作都会检查可能的错误情况，如文件不存在、权限不足、目录非空等，并输出相应的错误信息。

总结，`exec.h` 文件是 HUST-OS 课程设计项目中文件系统命令处理的核心，它定义了如何解析和执行用户输入的命令，以及如何处理命令执行过程中可能出现的各种情况。

## 文件 `fs_error.h` 是项目中的一个头文件，位于 `filesystem` 目录下。这个文件定义了一系列宏，用于表示文件系统操作中可能出现的错误代码。这些错误代码用于在文件系统模块中指示不同类型的错误或状态，以便于程序的其他部分能够根据这些代码进行相应的处理。

文件中定义的宏可以分为几个类别：
1. **成功状态**：`FS_OK` 表示操作成功。
2. **文件或目录不存在**：如 `FS_NO_EXIST`、`FS_NO_BLOCK`、`FS_NO_INODE` 等。
3. **读写错误**：`FS_RD_ERROR` 和 `FS_WR_ERROR` 分别表示读取和写入错误。
4. **空间不足**：`FS_DIR_FULL` 表示目录已满。
5. **文件或目录状态错误**：如 `FS_IS_FILE`、`FS_IS_DIR`、`FS_ISNOT_FILE`、`FS_ISNOT_DIR` 等。
6. **权限错误**：`FS_NO_PRIVILAGE` 表示没有权限。
7. **用户相关错误**：如 `FS_USER_EXIST`、`FS_USER_NOT_EXIST`。
8. **模式错误**：`FS_INVALID_MODE` 表示无效的模式。
9. **一般无效状态**：`FS_INVALID` 表示一般无效状态。
10. **登录相关错误**：`FS_LOGIN` 和 `FS_LOGIN_ERROR` 分别表示登录状态和登录错误。

这些宏的使用可以帮助开发者清晰地识别和处理文件系统操作中的各种错误情况，提高代码的可读性和可维护性。通过预处理器指令 `#ifndef`、`#define` 和 `#endif` 确保这些宏在整个项目中只被定义一次，避免重复定义的问题。

## 文件 `filesystem.h` 是 filesystem 项目中的一个关键头文件，它定义了一个简单的文件系统的结构和操作。以下是对该文件内容的概述：

1. **宏定义**：
   - 定义了文件系统的各种参数，如块大小（BLOCKSIZE）、inode数量（INODENUM）、磁盘大小（BLOCKNUM）、文件最大大小（FILEBLKMAX）、文件名和用户名的最大长度等。
   - 定义了文件和目录的类型（TYPE_DIR 和 TYPE_FILE）、读写权限（CAN_READ 和 CAN_WRITE）等。

2. **数据结构**：
   - `super_block`：超级块结构，包含inode映射、块映射、inode和块的空闲数量。
   - `inode`：inode结构，包含使用的块、块使用数量、文件大小、权限、创建和修改时间、用户ID等。
   - `directory`：目录结构，包含文件名和inode ID。
   - `user`：用户结构，包含用户名和密码。
   - `sys_users`：系统用户结构，包含用户映射、用户数量和用户列表。

3. **全局变量**：
   - 定义了文件系统的全局变量，如磁盘文件指针、当前inode ID、当前inode、当前目录内容、当前用户ID等。

4. **函数声明**：
   - **开发者函数**：用于调试和测试，如重置磁盘、打印用户ID、inode ID、目录数量等。
   - **核心函数**：如分配和释放inode及块、初始化目录和文件inode等。
   - **用户函数**：如用户登录、添加、删除等。
   - **磁盘函数**：如加载超级块、格式化磁盘、关闭磁盘等。
   - **文件和目录函数**：如打开和关闭目录、创建和删除文件、改变目录、列出目录内容等。
   - **辅助函数**：如将八进制转换为十进制、检查文件名、检查文件类型和权限等。

这个头文件为文件系统的实现提供了必要的结构定义和函数接口，是整个文件系统设计的基础。通过这些定义和声明，可以实现一个基本的文件系统操作，如文件的创建、读写、删除以及用户管理等。

